<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Anima v3 - Nuitka Compilation Issues</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Raleway:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Nova
  * Updated: Jan 09 2024 with Bootstrap v5.3.2
  * Template URL: https://bootstrapmade.com/nova-bootstrap-business-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="page-blog">

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="d-flex align-items-center">Anima v3</h1>
      </a>

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="index.html"></a>Home</a></li>
          <li><a href="requirements.html">Requirements</a></li>
          <li class="dropdown"><a href="research.html" class="active"><span>Research</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
            <ul>
              <li><a href="nuitka.html">Nuitka Compilation Issues</a></li>
              <li><a href="pyinstaller.html">Pyinstaller Compilation Issues</a></li>
            </ul>
          </li>
          <li><a href="ui-design.html">User Interface Design</a></li>
          <li><a href="about.html">Services</a></li>
          <li><a href="portfolio.html">Portfolio</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <div class="breadcrumbs d-flex align-items-center" style="background-image: url('assets/img/compilation.jpeg');">
      <div class="container position-relative d-flex flex-column align-items-center">

        <h2>Nuitka Compilation Issues</h2>
        <ol>
          <li><a href="research.html">Research</a></li>
          <li>Nuitka Compilation Issues</li>
        </ol>

      </div>
    </div><!-- End Breadcrumbs -->

    <!-- ======= Blog Details Section ======= -->
    <section id="blog" class="blog">
      <div class="container" data-aos="fade-up">

        <div class="row g-5">

          <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">

            <article class="blog-details">

              <div class="post-img">
                <img src="assets/img/compilation2.jpeg" alt="" class="img-fluid">
              </div>

              <div class="content">
                <h1 class="title" style="color:blue">Every Problem Faced With Nuitka</h1>
                <h3><strong>Overview</strong></h3>
                <p>
                  Nuitka is a source-to-source compiler which compiles Python code to C source code. The below screenshot shows the core of the compilation problem with Nuitka. The neural network based TTS model (Coqui) that we have chosen is build on libraries like pynndescent, pytorch, librosa that depend on a just-in-time compiler library called Numba. 
                </p>
                <img src="assets/img/nuitka2.png" style="max-width: 700px; max-height: 300px; border-radius: 20px;" class=img-fluid alt="">

                <h3><strong>Numba-Nuitka Incompatibility</strong></h3>
                <p>
                  TTS is the core library used by Anima V2 project, and Librosa is a dependency of this library. Meanwhile, librosa also depends on Numba, which is an open-source compiler translating Python and Numpy into machine code. However, there exists an incompatibility between Nuitka and Numba. In June 2023, a Github user opened an issue that is similar to our issue on Nuitka Github repository. When using Nuitka to compile a Python project including Numba, a warning, “Numba is not yet working with Nuitka standalone”, is printed in the terminal. Nuitka author, kayhayen in June 2023, replied that the compatibility issue between Nuitka and Numba cannot be resolved for now. Kayhayen has not managed to find a good way to compile Numba source code.                </p>
                <img src="assets/img/nuitka3.png" style="max-width: 800px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <h3><strong>Possible solutions for the fundamental incompatibility issue</strong></h3>
                <style>
                  .reduce-text-size p {
                    font-size: 16px !important;
                    font-style: normal !important;
                  }
                </style>
                <blockquote class="reduce-text-size">
                    <h4><strong>1. Compile functions using Numba-Ahead of Time (AOT)</strong></h4><br>
                    <p>
                      
                      The first solution is compiling all functions in the source code of the libraries into a file and use the compiled version of the functions whenever the function is called. The problem with this approach is very evident. It is a great undertaking for us to get every import correctly, make sure there is no circular import considering we would import the function to compile and then import the compiled function back to the source code to use. Moreover, we would have to determine every function that utilizes the Numba functions and correctly implement the compiled function into the code without breaking it. After speaking with our advisors, they have said that this would take more than the allocated time for the project and agreed that this is not a viable approach and suggested we move on with the second approach, which is getting rid of all Numba code in the source libraries.
                      <br>
                    </p>
                  </blockquote>
                  <img src="assets/img/nuitka4.png" style="max-width: 800px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                  <blockquote class="reduce-text-size">
                    <h4><strong>2. Remove Numba from library source codes</strong></h4><br>
                    <p>
                      The second option is removing all Numba code from the library source codes. This is much more viable and this is the approach we took. All Numba decorators that enable just in time compilation are gotten rid of. For most libraries Numba data types are also used outside of decorators so we replaced those with appropriate numpy or Python data types. This will certainly slow-down the software considerably however our primary goal is to just make it work, and as can be seen on the next page, even getting rid of all Numba code in source libraries does not solve all of our problems. We think that there might be better tools for this job than Nuitka therefore we will also explore pyintsaller which bundles everything into an executable without compiling them into C.
                    </p>
                    <br>
                </blockquote>
                <img src="assets/img/nutika6.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <br>
                <h3><strong>Potential issues that may result from removing Numba from PyPI libraries</strong></h3>
                <p>All third-party libraries that we used in the Anima project are conventionally installed via the Python Package Index(PyPI). However, when we undertake modifications of removing Numba to the source code of official libraries, this alteration engenders a substantial deviation from the official version, it means that we no longer install libraries through PyPI, but have to manually include relevant libraries in the project. Consequently, the adoption of this approach gives up the ability to seamlessly integrate future updates from the official libraries. This decision, while allowing for project-specific adjustments, concurrently introduces a potential diminution in the overall maintainability of the Anima project.</p>
                <br>
                <h3><strong>Import errors that needed to be copied into Nuitka generated directory</strong></h3>
                <p><strong>torchaudio library</strong></p>
                <img src="assets/img/nuitka7.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <p><strong>librosa library</strong></p>
                <img src="assets/img/nuitka8.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <p><strong>trainer library</strong></p>
                <img src="assets/img/nuitka9.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <p><strong>src directory</strong></p>
                <img src="assets/img/nuitka10.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <p><strong>resampy library</strong></p>
                <img src="assets/img/nuitka11.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">
                <p><strong>TTS library</strong></p>
                <img src="assets/img/nuitka12.png" style="max-width: 700px; max-height: 400px; border-radius: 20px;" class=img-fluid alt="">

                <blockquote>
                    <p>
                      <strong>The problem we could not fix</strong><br>
                      The code is looking for vits_config.py file under the encoder.configs, vocoder.configs and tts.configs directories and it only exists under tts.configs. print statements do not print anything in library source code even when we clear cache so we are not sure as to how to troubleshoot. We have added the vits_config.py file to both vocoder.configs and encoder.configs but that did not solve the issue. We are stuck and this is likely not the last error. Frankly, we do not think solving all these errors manually by either dragging files or changing the source code of libraries will solve this issue for us. As we have spent a very long time just trying to compile this project using Nuitka we are willing to try alternatives which might be easier such as pyinstaller.                    </p>
                    <img src="assets/img/nuitka13.png" style="max-width: 700px; max-height: 500px; border-radius: 20px;" class=img-fluid alt="">
                </blockquote>
                
              </div><!-- End post content -->

              <div class="meta-bottom"></div>
                <i class="bi bi-tags"></i>
                <ul class="tags">
                  <li><a href="#">Voice-banking</a></li>
                </ul>
              </div><!-- End meta bottom -->

            </article><!-- End blog post -->
      </div>
    </section><!-- End Blog Details Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">

    <div class="footer-content">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-5 col-md-12 footer-info">
            <a href="index.html" class="logo d-flex align-items-center">
              <span>Anima v3</span>
            </a>
            <p>A software that preserves the person's voice so that even when their natural voice is lost, their sense of self is not.</p>
            <div class="social-links d-flex  mt-3">
              <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
              <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
              <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
              <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
            </div>
          </div>

          <div class="col-lg-2 col-6 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bi bi-dash"></i> <a href="#">Home</a></li>
              <li><i class="bi bi-dash"></i> <a href="#">About us</a></li>
              <li><i class="bi bi-dash"></i> <a href="#">Services</a></li>
              <li><i class="bi bi-dash"></i> <a href="#">Terms of service</a></li>
              <li><i class="bi bi-dash"></i> <a href="#">Privacy policy</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
            <h4>Contact Us</h4>
            <p>
              Gower St. <br>
              London<br>
              United Kingdom <br><br>
              <strong>Phone:</strong> +44 5589 55488 55<br>
              <strong>Email:</strong> zasdfasf@ucl.ac.uk<br>
            </p>

          </div>

        </div>
      </div>
    </div>

    <div class="footer-legal">
      <div class="container">
        <div class="copyright">
          &copy; Copyright <strong><span>Anima v3</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
          <!-- All the links in the footer should remain intact. -->
          <!-- You can delete the links only if you purchased the pro version. -->
          <!-- Licensing information: https://bootstrapmade.com/license/ -->
          <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nova-bootstrap-business-template/ -->
          Designed by <p>Team 12</p>
        </div>
      </div>
    </div>
  </footer><!-- End Footer --><!-- End Footer -->

  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>